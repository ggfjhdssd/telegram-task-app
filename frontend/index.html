<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayCoinads</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 20px 15px 100px;
        }

        /* Welcome Card - ·Äú·Äæ·Äï·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äí·ÄÆ·Äá·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄØ·Äï·Äº·ÄÑ·Ä∫·Äë·Ä¨·Ä∏ */
        .welcome-card {
            background: linear-gradient(145deg, #ffd700, #ffa500);
            color: #1a1a2e;
            padding: 30px 20px;
            border-radius: 30px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .welcome-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: shine 5s infinite;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .welcome-card h1 {
            font-size: 40px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
        }

        .welcome-card .username-big {
            font-size: 24px;
            font-weight: bold;
            background: rgba(255,255,255,0.3);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            margin: 10px 0;
            backdrop-filter: blur(5px);
        }

        .welcome-card .welcome-text {
            font-size: 18px;
            margin-top: 10px;
            font-weight: 500;
            color: #4a2c00;
        }

        /* Withdrawal Button */
        .withdraw-button {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            padding: 18px 30px;
            border-radius: 60px;
            font-weight: bold;
            font-size: 22px;
            text-align: center;
            margin: 20px 0 30px;
            cursor: pointer;
            box-shadow: 0 15px 30px rgba(0, 176, 155, 0.4);
            transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .withdraw-button:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 176, 155, 0.6);
        }

        .withdraw-button:active {
            transform: scale(0.98);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .username {
            font-size: 14px;
            color: #a0a0a0;
        }

        .coin-balance {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 30px;
            border: 1px solid #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #ffd700;
        }

        .card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(79,172,254,0.3);
        }

        .flame-icon {
            font-size: 40px;
            animation: burn 1s infinite alternate;
        }

        @keyframes burn {
            0% { filter: drop-shadow(0 0 5px #ff4500); transform: scale(1); }
            100% { filter: drop-shadow(0 0 20px #ffae00); transform: scale(1.1); }
        }

        .coin-icon {
            font-size: 40px;
            animation: sway 2.5s infinite ease-in-out;
        }

        @keyframes sway {
            0% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            100% { transform: rotate(-10deg); }
        }

        .task-title {
            flex: 1;
            margin-left: 20px;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            min-width: 85px;
            transition: all 0.2s;
        }

        .btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 8px 18px rgba(58,123,213,0.6);
        }

        .btn:disabled {
            background: rgba(255,255,255,0.1);
            color: #888;
            cursor: not-allowed;
        }

        nav {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 380px;
            background: rgba(10,10,25,0.85);
            backdrop-filter: blur(15px);
            display: flex;
            justify-content: space-around;
            padding: 12px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-item {
            text-align: center;
            color: #888;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: #ffd700;
        }

        .nav-item:hover {
            color: #fda085;
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .placeholder {
            text-align: center;
            padding: 50px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            color: #aaa;
        }

        .profile-info {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
        }

        .profile-info p {
            margin: 10px 0;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="profile">
                <div class="avatar">üí∞</div>
                <div>
                    <h4>PayCoinads</h4>
                    <span class="username" id="usernameDisplay">@username</span>
                </div>
            </div>
            <div class="coin-balance">
                <span>ü™ô</span>
                <span id="totalCoins">0</span>
            </div>
        </header>

        <!-- Welcome Card (·Ä°·Äû·ÄÖ·Ä∫) -->
        <div class="welcome-card" id="welcomeCard">
            <h1>·Äô·ÄÑ·Ä∫·Äπ·ÄÇ·Äú·Ä¨·Äï·Ä´ üñêÔ∏è</h1>
            <div class="username-big" id="welcomeUsername">@username</div>
            <div class="welcome-text">PayCoinads ·Äô·Äæ ·ÄÄ·Äº·Ä≠·ÄØ·ÄÜ·Ä≠·ÄØ·Äï·Ä´·Äê·Äö·Ä∫</div>
        </div>

        <!-- Withdrawal Button (·Äï·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÜ·Ä∂·Äë·ÄØ·Äê·Ä∫·Äõ·Äî·Ä∫) -->
        <div class="withdraw-button" id="withdrawBtn">
            üí∞ WITHDRAWAL MONEY <br> (·Äï·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÜ·Ä∂·Äë·ÄØ·Äê·Ä∫·Äõ·Äî·Ä∫)
        </div>

        <!-- Home Section -->
        <div id="homeSection" class="section active">
            <div class="card">
                <div class="flame-icon">üî•</div>
                <div class="task-title">Daily Check-in (+15)</div>
                <button class="btn" id="dailyBtn">Check-in</button>
            </div>

            <div class="card">
                <div class="coin-icon">ü™ô</div>
                <div class="task-title">Task 1 (+30)</div>
                <button class="btn task-btn" data-id="task1">Get +30</button>
            </div>
            <div class="card">
                <div class="coin-icon">ü™ô</div>
                <div class="task-title">Task 2 (+30)</div>
                <button class="btn task-btn" data-id="task2">Get +30</button>
            </div>
            <div class="card">
                <div class="coin-icon">ü™ô</div>
                <div class="task-title">Task 3 (+30)</div>
                <button class="btn task-btn" data-id="task3">Get +30</button>
            </div>
            <div class="card">
                <div class="coin-icon">ü™ô</div>
                <div class="task-title">Task 4 (+30)</div>
                <button class="btn task-btn" data-id="task4">Get +30</button>
            </div>
            <div class="card">
                <div class="coin-icon">ü™ô</div>
                <div class="task-title">Task 5 (+30)</div>
                <button class="btn task-btn" data-id="task5">Get +30</button>
            </div>
        </div>

        <!-- Earn Section -->
        <div id="earnSection" class="section">
            <div class="placeholder">
                <h2>üí∞ Earn More Coins</h2>
                <p>Watch ads & complete offers</p>
                <p style="margin-top:20px;">Coming Soon...</p>
            </div>
        </div>

        <!-- Games Section -->
        <div id="gamesSection" class="section">
            <div class="placeholder">
                <h2>üéÆ Play Games</h2>
                <p>Earn while having fun</p>
                <p style="margin-top:20px;">Coming Soon...</p>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section">
            <div class="profile-info">
                <div class="avatar" style="width:80px; height:80px; font-size:48px; margin:0 auto 20px;">üí∞</div>
                <p><strong>Username:</strong> <span id="profileUsername">@username</span></p>
                <p><strong>Coins:</strong> <span id="profileCoins">0</span></p>
                <p><strong>Member Since:</strong> 2026</p>
                <p><strong>Platform:</strong> PayCoinads</p>
            </div>
        </div>

        <!-- Navigation -->
        <nav>
            <div class="nav-item active" data-tab="home"><div class="nav-icon">üè†</div>Home</div>
            <div class="nav-item" data-tab="earn"><div class="nav-icon">üí∞</div>Earn</div>
            <div class="nav-item" data-tab="games"><div class="nav-icon">üéÆ</div>Games</div>
            <div class="nav-item" data-tab="profile"><div class="nav-icon">üë§</div>Profile</div>
        </nav>
    </div>

    <script>
        // ==================== Configuration ====================
        const API_BASE = 'https://telegram-task-app-coik.onrender.com'; 
        const tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.expand();
            tg.ready();
        }

        const initData = tg?.initData || '';

        // DOM Elements
        const usernameSpan = document.getElementById('usernameDisplay');
        const profileUsername = document.getElementById('profileUsername');
        const welcomeUsername = document.getElementById('welcomeUsername');
        const totalCoinsSpan = document.getElementById('totalCoins');
        const profileCoinsSpan = document.getElementById('profileCoins');
        const dailyBtn = document.getElementById('dailyBtn');
        const taskBtns = document.querySelectorAll('.task-btn');
        const withdrawBtn = document.getElementById('withdrawBtn');

        // ==================== Withdrawal Button Click ====================
        withdrawBtn.addEventListener('click', () => {
            alert('üí∏ Withdrawal feature coming soon!\n·ÄÑ·ÄΩ·Ä±·Äë·ÄØ·Äê·Ä∫·Äõ·Äî·Ä∫ ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫ ·Äô·ÄÄ·Äº·Ä¨·ÄÅ·ÄÑ·Ä∫ ·Äú·Ä¨·Äï·Ä´·Äô·Äö·Ä∫·Åã');
        });

        // ==================== Helper Functions ====================
        function formatTime(ms) {
            if (ms < 0) ms = 0;
            const sec = Math.floor(ms / 1000);
            const h = Math.floor(sec / 3600).toString().padStart(2, '0');
            const m = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
            const s = (sec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        // Update UI with user data from server
        function updateUI(data) {
            const displayName = data.username ? '@' + data.username : 'User';
            usernameSpan.innerText = displayName;
            profileUsername.innerText = displayName;
            welcomeUsername.innerText = displayName;

            totalCoinsSpan.innerText = data.coins.toLocaleString();
            profileCoinsSpan.innerText = data.coins.toLocaleString();

            const now = Date.now();
            const dailyLast = data.dailyLastClaim || 0;
            const dailyRemaining = (24 * 60 * 60 * 1000) - (now - dailyLast);

            if (dailyRemaining > 0 && dailyLast !== 0) {
                dailyBtn.disabled = true;
                dailyBtn.innerText = formatTime(dailyRemaining);
            } else {
                dailyBtn.disabled = false;
                dailyBtn.innerText = 'Check-in';
            }

            taskBtns.forEach(btn => {
                const taskId = btn.dataset.id;
                const last = data.tasks?.[taskId] || 0;
                const remaining = (2 * 60 * 60 * 1000) - (now - last);

                if (remaining > 0 && last !== 0) {
                    btn.disabled = true;
                    btn.innerText = formatTime(remaining);
                } else {
                    btn.disabled = false;
                    btn.innerText = 'Get +30';
                }
            });
        }

        // Fetch user data from backend
        async function fetchUser() {
            try {
                const res = await fetch(`${API_BASE}/api/user`, {
                    headers: { 'X-Telegram-Init-Data': initData }
                });
                const data = await res.json();
                if (res.ok) {
                    updateUI(data);
                    startLocalTimers(data);
                }
            } catch (err) {
                console.error('Fetch user error:', err);
            }
        }

        // Start local countdowns
        function startLocalTimers(data) {
            const now = Date.now();
            const dailyLast = data.dailyLastClaim || 0;
            const dailyRemaining = (24 * 60 * 60 * 1000) - (now - dailyLast);

            if (dailyRemaining > 0 && dailyLast !== 0) {
                const updateDaily = () => {
                    const remaining = (24 * 60 * 60 * 1000) - (Date.now() - dailyLast);
                    if (remaining <= 0) {
                        dailyBtn.disabled = false;
                        dailyBtn.innerText = 'Check-in';
                    } else {
                        dailyBtn.disabled = true;
                        dailyBtn.innerText = formatTime(remaining);
                        setTimeout(updateDaily, 1000);
                    }
                };
                updateDaily();
            }

            taskBtns.forEach(btn => {
                const taskId = btn.dataset.id;
                const last = data.tasks?.[taskId] || 0;
                const remaining = (2 * 60 * 60 * 1000) - (now - last);

                if (remaining > 0 && last !== 0) {
                    const updateTask = () => {
                        const remaining = (2 * 60 * 60 * 1000) - (Date.now() - last);
                        if (remaining <= 0) {
                            btn.disabled = false;
                            btn.innerText = 'Get +30';
                        } else {
                            btn.disabled = true;
                            btn.innerText = formatTime(remaining);
                            setTimeout(updateTask, 1000);
                        }
                    };
                    updateTask();
                }
            });
        }

        // Daily claim
        dailyBtn.addEventListener('click', async () => {
            if (dailyBtn.disabled) return;
            try {
                const res = await fetch(`${API_BASE}/api/claim/daily`, {
                    method: 'POST',
                    headers: { 'X-Telegram-Init-Data': initData }
                });
                const data = await res.json();
                if (res.ok) {
                    fetchUser(); // refresh all
                } else {
                    alert(data.error || 'Claim failed');
                }
            } catch (err) {
                console.error('Daily claim error:', err);
            }
        });

        // Task claim
        taskBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                if (btn.disabled) return;
                const taskId = btn.dataset.id;
                try {
                    const res = await fetch(`${API_BASE}/api/claim/task/${taskId}`, {
                        method: 'POST',
                        headers: { 'X-Telegram-Init-Data': initData }
                    });
                    const data = await res.json();
                    if (res.ok) {
                        fetchUser();
                    } else {
                        alert(data.error || 'Claim failed');
                    }
                } catch (err) {
                    console.error('Task claim error:', err);
                }
            });
        });

        // Tab Navigation
        const navItems = document.querySelectorAll('.nav-item');
        const sections = {
            home: document.getElementById('homeSection'),
            earn: document.getElementById('earnSection'),
            games: document.getElementById('gamesSection'),
            profile: document.getElementById('profileSection')
        };

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(n => n.classList.remove('active'));
                item.classList.add('active');

                Object.values(sections).forEach(s => s.classList.remove('active'));
                const tab = item.dataset.tab;
                if (sections[tab]) sections[tab].classList.add('active');
            });
        });

        // Start
        fetchUser();
    </script>
</body>
</html>
